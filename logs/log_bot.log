06-08-2025 08:33:55 - INFO - root - [configurar_logging] - Logging configurado. Os logs serão salvos em: logs\log_bot.log
06-08-2025 08:33:55 - INFO - app.main - [lifespan] - Iniciando a API e configurando recursos...
06-08-2025 08:33:55 - INFO - app.main - [lifespan] - Conectando ao LLM: llama3.1 em http://127.0.0.1:11434
06-08-2025 08:33:55 - INFO - app.main - [lifespan] - Instância do LLM criada e pronta para uso.
06-08-2025 08:34:04 - INFO - app.core.orquestrador - [gerenciar_consulta_usuario] - --- INÍCIO DA ORQUESTRAÇÃO PARA: 'quais os 5 produtos mais vendidos?' ---
06-08-2025 08:34:04 - INFO - app.agentes.agente_roteador - [obter_intencao] - Iniciando roteamento de intenção do usuário.
06-08-2025 08:34:04 - DEBUG - app.agentes.agente_roteador - [obter_intencao] - Enviando para o LLM para extração: 'quais os 5 produtos mais vendidos?'
06-08-2025 08:34:10 - INFO - app.agentes.agente_roteador - [obter_intencao] - Dicionário extraído com sucesso: {'intencao': 'buscar_produtos_classificados', 'entidades': {'criterio_classificacao': 'mais_vendidos', 'limite': 5}}
06-08-2025 08:34:10 - ERROR - app.core.orquestrador - [gerenciar_consulta_usuario] - Erro inesperado na orquestração: construir_query_produtos_classificados() got an unexpected keyword argument 'filtros'
Traceback (most recent call last):
  File "P:\Informatica\Projetos\Projetos-Ajustados\02-Python\IA-Atendimento\app\core\orquestrador.py", line 192, in gerenciar_consulta_usuario
    query_sql, params = await manipulador(entidades)
  File "P:\Informatica\Projetos\Projetos-Ajustados\02-Python\IA-Atendimento\app\core\orquestrador.py", line 52, in _manipular_produtos_classificados
    return ferramentas_sql.construir_query_produtos_classificados(
TypeError: construir_query_produtos_classificados() got an unexpected keyword argument 'filtros'
06-08-2025 08:35:00 - INFO - app.main - [lifespan] - Encerrando a API e limpando recursos...
06-08-2025 08:35:02 - INFO - root - [configurar_logging] - Logging configurado. Os logs serão salvos em: logs\log_bot.log
06-08-2025 08:35:02 - INFO - app.main - [lifespan] - Iniciando a API e configurando recursos...
06-08-2025 08:35:02 - INFO - app.main - [lifespan] - Conectando ao LLM: llama3.1 em http://127.0.0.1:11434
06-08-2025 08:35:02 - INFO - app.main - [lifespan] - Instância do LLM criada e pronta para uso.
06-08-2025 08:35:02 - INFO - app.core.orquestrador - [gerenciar_consulta_usuario] - --- INÍCIO DA ORQUESTRAÇÃO PARA: 'quais os 5 produtos mais vendidos?' ---
06-08-2025 08:35:02 - INFO - app.agentes.agente_roteador - [obter_intencao] - Iniciando roteamento de intenção do usuário.
06-08-2025 08:35:02 - DEBUG - app.agentes.agente_roteador - [obter_intencao] - Enviando para o LLM para extração: 'quais os 5 produtos mais vendidos?'
06-08-2025 08:35:04 - INFO - app.agentes.agente_roteador - [obter_intencao] - Dicionário extraído com sucesso: {'intencao': 'buscar_produtos_classificados', 'entidades': {'criterio_classificacao': 'mais_vendidos', 'limite': 5}}
06-08-2025 08:35:04 - INFO - app.ferramentas.ferramentas_sql - [construir_query_produtos_classificados] - Construindo query de ranking de produtos com critério: mais_vendidos
06-08-2025 08:35:04 - INFO - app.db.consultas - [executar_consulta_selecao] - Iniciando execução de query SELECT no banco de dados.
06-08-2025 08:35:04 - DEBUG - app.db.consultas - [_gerenciar_conexao_bd] - Conexão com o banco 'prod' estabelecida com sucesso.
06-08-2025 08:35:04 - DEBUG - app.db.consultas - [_executar_sincronamente] - Executando SQL: 
        SELECT P.CODPROD, P.DESCRICAO, P.PVENDA, VENDAS.TOTAL_VENDIDO
        FROM PCPRODUT P
        JOIN (
            SELECT I.CODPROD, COUNT(I.CODPROD) AS TOTAL_VENDIDO
            FROM PCPEDI I
            JOIN PCPEDC C ON I.NUMPED = C.NUMPED
            
            GROUP BY I.CODPROD
        ) VENDAS ON P.CODPROD = VENDAS.CODPROD
        WHERE P.DTEXCLUSAO IS NULL
        ORDER BY TOTAL_VENDIDO DESC
        FETCH FIRST :limite ROWS ONLY
     com parâmetros: {'limite': 5}
06-08-2025 08:47:40 - INFO - root - [configurar_logging] - Logging configurado. Os logs serão salvos em: logs\log_bot.log
06-08-2025 08:47:40 - INFO - app.main - [lifespan] - Iniciando a API e configurando recursos...
06-08-2025 08:47:40 - INFO - app.main - [lifespan] - Conectando ao LLM: llama3.1 em http://127.0.0.1:11434
06-08-2025 08:47:40 - INFO - app.main - [lifespan] - Instância do LLM criada e pronta para uso.
06-08-2025 08:47:47 - INFO - app.core.orquestrador - [gerenciar_consulta_usuario] - --- INÍCIO DA ORQUESTRAÇÃO PARA: 'quais os 5 produtos mais vendidos?' ---
06-08-2025 08:47:47 - INFO - app.agentes.agente_roteador - [obter_intencao] - Iniciando roteamento de intenção do usuário.
06-08-2025 08:47:47 - DEBUG - app.agentes.agente_roteador - [obter_intencao] - Enviando para o LLM para extração: 'quais os 5 produtos mais vendidos?'
06-08-2025 08:47:51 - INFO - app.agentes.agente_roteador - [obter_intencao] - Dicionário extraído com sucesso: {'intencao': 'buscar_produtos_classificados', 'entidades': {'criterio_classificacao': 'mais_vendidos', 'limite': 5}}
06-08-2025 08:47:51 - INFO - app.ferramentas.ferramentas_sql - [construir_query_produtos_classificados] - Construindo query de ranking de produtos com critério: mais_vendidos
06-08-2025 08:47:51 - INFO - app.db.consultas - [executar_consulta_selecao] - Iniciando execução de query SELECT no banco de dados.
06-08-2025 08:47:51 - DEBUG - app.db.consultas - [_gerenciar_conexao_bd] - Conexão com o banco 'prod' estabelecida com sucesso.
06-08-2025 08:47:51 - DEBUG - app.db.consultas - [_executar_sincronamente] - Executando SQL: 
        SELECT /*+ FIRST_ROWS(5) INDEX_COMBINE(P) */ 
               P.CODPROD, P.DESCRICAO, P.PVENDA, VENDAS.TOTAL_VENDIDO
        FROM PCPRODUT P
        INNER JOIN (
            SELECT /*+ INDEX(I IDX_PCPEDI_CODPROD) INDEX(C IDX_PCPEDC_DATA) */
                   I.CODPROD, COUNT(*) AS TOTAL_VENDIDO
            FROM PCPEDI I
            INNER JOIN PCPEDC C ON I.NUMPED = C.NUMPED
            WHERE 1=1 
            GROUP BY I.CODPROD
        ) VENDAS ON P.CODPROD = VENDAS.CODPROD
        WHERE P.DTEXCLUSAO IS NULL
        ORDER BY TOTAL_VENDIDO DESC
        FETCH FIRST :limite ROWS ONLY
     com parâmetros: {'limite': 5}
06-08-2025 09:08:11 - INFO - root - [configurar_logging] - Logging configurado. Os logs serão salvos em: logs\log_bot.log
06-08-2025 09:08:11 - INFO - app.main - [lifespan] - Iniciando a API e configurando recursos...
06-08-2025 09:08:11 - INFO - app.main - [lifespan] - Conectando ao LLM: llama3.1 em http://127.0.0.1:11434
06-08-2025 09:08:11 - INFO - app.main - [lifespan] - Instância do LLM criada e pronta para uso.
06-08-2025 09:14:33 - INFO - app.core.orquestrador - [gerenciar_consulta_usuario] - --- INÍCIO DA ORQUESTRAÇÃO PARA: 'quais os 5 produtos mais vendidos este mes?' ---
06-08-2025 09:14:33 - INFO - app.agentes.agente_roteador - [obter_intencao] - Iniciando roteamento de intenção do usuário.
06-08-2025 09:14:33 - DEBUG - app.agentes.agente_roteador - [obter_intencao] - Enviando para o LLM para extração: 'quais os 5 produtos mais vendidos este mes?'
06-08-2025 09:14:40 - INFO - app.agentes.agente_roteador - [obter_intencao] - Dicionário extraído com sucesso: {'intencao': 'buscar_produtos_classificados', 'entidades': {'criterio_classificacao': 'mais_vendidos', 'periodo_tempo': 'este_mes', 'limite': 5}}
06-08-2025 09:14:40 - INFO - app.ferramentas.ferramentas_sql - [construir_query_produtos_classificados] - Construindo query de ranking de produtos com critério: mais_vendidos
06-08-2025 09:14:40 - INFO - app.db.consultas - [executar_consulta_selecao] - Iniciando execução de query SELECT no banco de dados.
06-08-2025 09:14:40 - DEBUG - app.db.consultas - [_gerenciar_conexao_bd] - Conexão com o banco 'prod' estabelecida com sucesso.
06-08-2025 09:14:40 - DEBUG - app.db.consultas - [_executar_sincronamente] - Executando SQL: 
        SELECT /*+ FIRST_ROWS(5) INDEX_COMBINE(P) */ 
               P.CODPROD, P.DESCRICAO, P.PVENDA, VENDAS.TOTAL_VENDIDO
        FROM PCPRODUT P
        INNER JOIN (
            SELECT /*+ INDEX(I IDX_PCPEDI_CODPROD) INDEX(C IDX_PCPEDC_DATA) */
                   I.CODPROD, COUNT(*) AS TOTAL_VENDIDO
            FROM PCPEDI I
            INNER JOIN PCPEDC C ON I.NUMPED = C.NUMPED
            WHERE 1=1 AND C.DATA >= :data_inicio AND C.DATA < :data_fim
            GROUP BY I.CODPROD
        ) VENDAS ON P.CODPROD = VENDAS.CODPROD
        WHERE P.DTEXCLUSAO IS NULL
        ORDER BY TOTAL_VENDIDO DESC
        FETCH FIRST :limite ROWS ONLY
     com parâmetros: {'limite': 5, 'data_inicio': datetime.datetime(2025, 8, 1, 0, 0), 'data_fim': datetime.datetime(2025, 9, 1, 0, 0)}
06-08-2025 09:15:01 - INFO - app.db.consultas - [_executar_sincronamente] - 5 registros retornados do banco.
06-08-2025 09:15:01 - DEBUG - app.db.consultas - [_gerenciar_conexao_bd] - Conexão com o banco de dados fechada.
06-08-2025 09:15:01 - INFO - app.agentes.agente_sumarizador - [sumarizar_resultados] - Iniciando a sumarização dos resultados.
06-08-2025 09:15:01 - DEBUG - app.agentes.agente_sumarizador - [sumarizar_resultados] - Enviando 5 registros para sumarização.
06-08-2025 09:15:08 - INFO - app.agentes.agente_sumarizador - [sumarizar_resultados] - Sumarização gerada com sucesso.
06-08-2025 09:15:08 - INFO - app.core.orquestrador - [gerenciar_consulta_usuario] - --- FIM DA ORQUESTRAÇÃO ---
06-08-2025 09:15:49 - INFO - app.core.orquestrador - [gerenciar_consulta_usuario] - --- INÍCIO DA ORQUESTRAÇÃO PARA: 'quero os mais vendidos da coca cola' ---
06-08-2025 09:15:49 - INFO - app.agentes.agente_roteador - [obter_intencao] - Iniciando roteamento de intenção do usuário.
06-08-2025 09:15:49 - DEBUG - app.agentes.agente_roteador - [obter_intencao] - Enviando para o LLM para extração: 'quero os mais vendidos da coca cola'
06-08-2025 09:15:51 - INFO - app.agentes.agente_roteador - [obter_intencao] - Dicionário extraído com sucesso: {'intencao': 'buscar_produtos_classificados', 'entidades': {'criterio_classificacao': 'mais_vendidos', 'nome_produto': 'Coca Cola'}}
06-08-2025 09:15:51 - INFO - app.ferramentas.ferramentas_sql - [construir_query_produtos_classificados] - Construindo query de ranking de produtos com critério: mais_vendidos
06-08-2025 09:15:51 - INFO - app.db.consultas - [executar_consulta_selecao] - Iniciando execução de query SELECT no banco de dados.
06-08-2025 09:15:52 - DEBUG - app.db.consultas - [_gerenciar_conexao_bd] - Conexão com o banco 'prod' estabelecida com sucesso.
06-08-2025 09:15:52 - DEBUG - app.db.consultas - [_executar_sincronamente] - Executando SQL: 
        SELECT /*+ FIRST_ROWS(10) INDEX_COMBINE(P) */ 
               P.CODPROD, P.DESCRICAO, P.PVENDA, VENDAS.TOTAL_VENDIDO
        FROM PCPRODUT P
        INNER JOIN (
            SELECT /*+ INDEX(I IDX_PCPEDI_CODPROD) INDEX(C IDX_PCPEDC_DATA) */
                   I.CODPROD, COUNT(*) AS TOTAL_VENDIDO
            FROM PCPEDI I
            INNER JOIN PCPEDC C ON I.NUMPED = C.NUMPED
            WHERE 1=1 
            GROUP BY I.CODPROD
        ) VENDAS ON P.CODPROD = VENDAS.CODPROD
        WHERE P.DTEXCLUSAO IS NULL
        ORDER BY TOTAL_VENDIDO DESC
        FETCH FIRST :limite ROWS ONLY
     com parâmetros: {'limite': 10}
06-08-2025 09:38:31 - INFO - app.db.consultas - [_executar_sincronamente] - 10 registros retornados do banco.
06-08-2025 09:38:31 - DEBUG - app.db.consultas - [_gerenciar_conexao_bd] - Conexão com o banco de dados fechada.
06-08-2025 09:38:31 - INFO - app.agentes.agente_sumarizador - [sumarizar_resultados] - Iniciando a sumarização dos resultados.
06-08-2025 09:38:31 - DEBUG - app.agentes.agente_sumarizador - [sumarizar_resultados] - Enviando 10 registros para sumarização.
06-08-2025 09:38:38 - INFO - app.agentes.agente_sumarizador - [sumarizar_resultados] - Sumarização gerada com sucesso.
06-08-2025 09:38:38 - INFO - app.core.orquestrador - [gerenciar_consulta_usuario] - --- FIM DA ORQUESTRAÇÃO ---
